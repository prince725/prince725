name: Update Profile README with Private Stats

on:
  schedule:
    - cron: "0 */12 * * *"   # updates every 12 hours
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      GH_TOKEN: ${{ secrets.GH_TOKEN }}
      USERNAME: prince725

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: Authenticate GH API for private stats
        run: |
          curl -H "Authorization: token $GH_TOKEN" https://api.github.com/user > /dev/null

      - name: Generate README content
        run: |
          echo "### Hi, I'm Prince ðŸ‘‹" > README.md
          echo "" >> README.md
          echo "ðŸš€ Automation Engineer | Swiggy | Blinkit | Zepto | Amazon Ads" >> README.md
          echo "" >> README.md
          echo "### ðŸ“Š GitHub Stats(last 12 hours)" >> README.md

          STATS_URL="https://github-readme-stats.vercel.app/api?username=$USERNAME&count_private=true&include_all_commits=true&show_icons=true&theme=tokyonight&hide_border=true"
          LANG_URL="https://github-readme-stats.vercel.app/api/top-langs/?username=$USERNAME&layout=compact&theme=tokyonight&hide_border=true"

          echo "![]($STATS_URL)" >> README.md
          echo "" >> README.md
          echo "![]($LANG_URL)" >> README.md
          echo "" >> README.md
          echo "> Auto-updated every 12 hours âš¡" >> README.md

      - name: Commit & Push
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add README.md
          git commit -m "auto: update profile README" || exit 0
          git push https://$USERNAME:$GH_TOKEN@github.com/$USERNAME/$USERNAME.git HEAD:main
